<!DOCTYPE html>
<html>
<head>
    <title>Voting System with Admin</title>
    <style>
        /* CSS styles remain the same */
    </style>
</head>
<body>
    <div class="container">
        <!-- HTML structure remains the same -->
    </div>
    <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js"></script>
<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAvh3FmKnK6Ys0JsaDIt5vETlD95uE4ZQ0",
        authDomain: "votingsystem-9a303.firebaseapp.com",
        databaseURL: "https://votingsystem-9a303-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "votingsystem-9a303",
        storageBucket: "votingsystem-9a303.firebasestorage.app",
        messagingSenderId: "339768050801",
        appId: "1:339768050801:web:8e64cf389c3930a90087d0",
        measurementId: "G-B6PSYQ1JV1"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let isLoggedIn = false;
    let isAdmin = false;
    const ADMIN_USERNAME = 'admin';
    const ADMIN_PASSWORD = 'admin123';
    let options = [
        { id: 1, title: 'Option 1', votes: 0 },
        { id: 2, title: 'Option 2', votes: 0 },
        { id: 3, title: 'Option 3', votes: 0 }
    ];

    function vote(id) {
        if (!isLoggedIn) return;

        const user = document.getElementById('userDisplay').textContent;

        // Increment vote count in Firebase
        firebase.database().ref('votes/' + id).transaction((currentVotes) => {
            return (currentVotes || 0) + 1;
        });

        // Save vote history
        const voteEntry = {
            timestamp: new Date().toISOString(),
            user: user,
            optionId: id
        };
        firebase.database().ref('voteHistory').push(voteEntry);

        loadOptions();
    }

    function loadOptions() {
        const list = document.getElementById('optionsList');
        list.innerHTML = '';

        // Fetch votes from Firebase
        firebase.database().ref('votes').once('value', (snapshot) => {
            const votes = snapshot.val() || {};

            options.forEach((option) => {
                const div = document.createElement('div');
                div.className = 'option';
                const voteCount = votes[option.id] || 0; // Default to 0 if no votes recorded

                div.innerHTML = `
                    <span>${option.title} <span class="vote-count">(${voteCount} votes)</span></span>
                    <button onclick="vote(${option.id})" class="button">Vote</button>
                `;
                list.appendChild(div);
            });
        });
    }

    function loadVoteHistory() {
        if (!isAdmin) return;

        const logElement = document.getElementById('voteLog');
        logElement.innerHTML = '';

        // Fetch vote history from Firebase
        firebase.database().ref('voteHistory').once('value', (snapshot) => {
            const history = snapshot.val() || {};

            Object.values(history).forEach((entry) => {
                const div = document.createElement('div');
                div.className = 'vote-entry';
                const date = new Date(entry.timestamp).toLocaleString();
                div.textContent = `${date} - User "${entry.user}" voted for option ID "${entry.optionId}"`;
                logElement.appendChild(div);
            });
        });
    }

    function clearVoteHistory() {
        if (!isAdmin) return;

        if (confirm('Are you sure you want to clear all vote history?')) {
            firebase.database().ref('voteHistory').remove();
            loadVoteHistory();
        }
    }

    function register() {
        const username = document.getElementById('newUsername').value;
        const password = document.getElementById('newPassword').value;

        if (!username || !password) {
            alert('Please fill in both fields.');
            return;
        }

        if (username === ADMIN_USERNAME) {
            alert('Cannot register as admin.');
            return;
        }

        // Store user in Firebase
        firebase.database().ref('users/' + username).set({
            password: password
        });

        alert(`User ${username} registered successfully.`);
    }

    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        firebase.database().ref('users/' + username).once('value', (snapshot) => {
            const user = snapshot.val();

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAdmin = true;
                isLoggedIn = true;
                document.getElementById('adminPanel').style.display = 'block';
            } else if (user && user.password === password) {
                isLoggedIn = true;
            } else {
                alert('Invalid credentials.');
                return;
            }

            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('votingSection').style.display = 'block';
            document.getElementById('userDisplay').textContent = username;
            loadOptions();
            loadVoteHistory();
        });
    }

    function logout() {
        isLoggedIn = false;
        isAdmin = false;
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('votingSection').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('registerForm').style.display = 'block';
        document.getElementById('userDisplay').textContent = '';
    }

    document.getElementById('searchInput')?.addEventListener('input', loadOptions);

    document.getElementById('shareButton')?.addEventListener('click', () => {
        navigator.clipboard.writeText(window.location.href);
        document.getElementById('shareMessage').style.display = 'block';
        setTimeout(() => {
            document.getElementById('shareMessage').style.display = 'none';
        }, 3000);
    });

    // Initial load
    loadOptions();
</script>
